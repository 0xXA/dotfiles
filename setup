#!/data/data/com.termux/files/usr/bin/bash

shopt -s extglob

[[ -e `pwd`/setup.cfg ]] && {
	set -a
	. `pwd`/setup.cfg
	set +a
} || exit 1

function install_packages {
	local packages=( 'aria2' 'bat' 'binutils' 'build-essential' 'curl' 'dirmngr' 'exa' 'file' 'gnupg' 'jq' 'p7zip' 'radare2' 'rsync' 'silversearcher-ag' 'strace' 'termux-api' 'termux-exec' 'tree' 'util-linux' 'unzip' 'vim' 'wget' 'zip' 'x11-repo' 'unstable-repo' )

	if ! dpkg --status "${packages[@]}" >/dev/null 2>&1; then
		pkg up
		pkg install "${packages[@]}"
		pkg install qemu-system-x86_64 qemu-user-x86_64
	fi
}

function install_gpgkeys {
	gpg_keys=( 'git.asc' )
	for gpgk in "${gpg_keys[@]}"; do \
		gpg --import `pwd`/keys/$gpgk; \
	done
	unset gpg_keys
}

function install_confs {
	cp `pwd`/.gitconfig $HOME/

	local files=(.bashrc .functions .variables .profile)
	for file in "${files[@]}"; do
		[[ ${file} = ".profile" ]] && {
			cp `pwd`/shells/bash/$file $PREFIX/etc/profile
		} || cp `pwd`/shells/bash/$file $HOME/
        done
	unset files file

	cp -r `pwd`/.termux/ ~/
	[[ -e $PREFIX/etc/motd ]] && \
		rm $PREFIX/etc/motd
}

[[ -n "${install_packages}" ]] && install_packages
[[ -n "${install_confs}" ]] && install_confs
[[ -n "${install_gpgkeys}" ]] && install_gpgkeys
